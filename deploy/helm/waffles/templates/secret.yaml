apiVersion: v1
kind: Secret
metadata:
  name: {{ include "waffles.fullname" . }}
  labels:
    {{- include "waffles.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.config.auth.sessionSecret }}
  session-secret: {{ .Values.config.auth.sessionSecret | b64enc | quote }}
  {{- else }}
  # Generate a random session secret if not provided
  session-secret: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
  {{- if and .Values.config.auth.oauth.enabled .Values.config.auth.oauth.clientSecret }}
  oauth-client-secret: {{ .Values.config.auth.oauth.clientSecret | b64enc | quote }}
  {{- end }}
  {{- if and .Values.config.auth.ldap.enabled .Values.config.auth.ldap.bindPassword }}
  ldap-bind-password: {{ .Values.config.auth.ldap.bindPassword | b64enc | quote }}
  {{- end }}
---
{{- if and (not .Values.postgresql.enabled) (not .Values.externalDatabase.existingSecret) .Values.externalDatabase.password }}
# External database password secret
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "waffles.fullname" . }}-db
  labels:
    {{- include "waffles.labels" . | nindent 4 }}
type: Opaque
data:
  password: {{ .Values.externalDatabase.password | b64enc | quote }}
{{- end }}
